function flatten(t){return _.isPlainObject(t)&&1===_.size(t)?flatten(_.values(t)[0]):t}function parse(t){var e={},n=3===t.nodeType,r=1===t.nodeType,a=t.textContent&&t.textContent.trim(),i=t.children&&t.children.length,u=t.attributes&&t.attributes.length;return n?t.nodeValue.trim():i||u?(!i&&a.length&&(e.text=a),r&&u&&(e.attributes=_.reduce(t.attributes,function(e,n,r){var a=t.attributes.item(r);return e[a.name]=a.value,e},{})),_.each(t.children,function(t){var n=t.nodeName;if(!_.has(e,n))return void(e[n]=parse(t));_.isArray(e[n])||(e[n]=[e[n]]),e[n].push(parse(t))}),_.each(e.attributes,function(t,n){null==e[n]&&(e[n]=t,delete e.attributes[n])}),_.isEmpty(e.attributes)&&delete e.attributes,flatten(e)):a}